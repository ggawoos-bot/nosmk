<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 등록/관리</title>
    <!-- Tailwind CSS CDN을 사용하여 스타일링을 적용합니다. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header-bar {
            background-color: #e5e7eb;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #d1d5db;
        }
        .header-bar span {
            font-weight: 500;
        }
        .btn {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-blue {
            background-color: #3b82f6;
            color: white;
        }
        .btn-blue:hover {
            background-color: #2563eb;
        }
        .btn-gray {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .btn-gray:hover {
            background-color: #d1d5db;
        }
        .form-input {
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        .grid-header {
            background-color: #dbeafe;
            color: #1e40af;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
        }
        .form-section {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: white;
        }
        /* 라벨 텍스트 크기 조정을 위한 새로운 클래스 */
        .form-label {
            font-size: 0.75rem;
        }
        /* 날짜 입력 아이콘을 위한 스타일 */
        .date-input-container {
            position: relative;
            width: 100%;
        }
        .date-input-container input[type="date"] {
            padding-right: 2rem;
        }
        .date-input-container::after {
            content: "📅";
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #4b5563;
        }
        /* 사용자그룹 라벨을 빨간색으로 변경하는 클래스 */
        .user-group-label {
            color: #ef4444;
        }
        /* 추가정보 섹션을 숨기기 위한 클래스 */
        .hidden-section {
            display: none;
        }
        /* 그리드 테이블 행 스타일 */
        .user-row {
            cursor: pointer;
        }
        .user-row:hover {
            background-color: #f3f4f6;
        }
        .user-row.selected {
            background-color: #dbeafe;
            color: #1e40af;
            font-weight: 600;
        }

        /* 팝업 모달 스타일 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">

    <!-- 초기 메시지 팝업 모달 -->
    <div id="initialMessageModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">사이트 안내</h2>
            <p class="text-gray-700 mb-4">
                본 사이트는 화면 구성여부를 판단하기 위한 가상 사이트입니다.<br>
                사용자그룹(붉은색)을 변경하면 사용자 추가정보를 입력할 수 있습니다.
            </p>
            <div class="flex items-center justify-center mb-4 text-sm">
                <input type="checkbox" id="doNotShowAgain" class="mr-2">
                <label for="doNotShowAgain">앞으로 보이지 않기</label>
            </div>
            <button id="closeModalBtn" class="btn btn-blue w-full">닫기</button>
        </div>
    </div>

    <!-- Header Section -->
    <div class="header-bar flex items-center justify-between rounded-t-lg">
        <div class="flex items-center space-x-2 text-sm">
            <span>사업자 등록 > 사용자 등록/관리</span>
        </div>
        <div class="flex items-center space-x-2">
            <button class="btn btn-blue" id="newBtn">신규</button>
            <button class="btn btn-blue" id="searchBtn">조회</button>
            <button class="btn btn-blue" id="saveBtn">저장</button>
            <button class="btn btn-blue" id="excelBtn">엑셀</button>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="container p-4 bg-white rounded-b-lg shadow-lg">
        <!-- Top Filters Section -->
        <div class="flex items-center space-x-4 mb-4 text-sm">
            <div class="flex items-center space-x-2">
                <span class="form-label">기관유형</span>
                <select class="form-input w-28" id="agencyTypeSelect">
                    <option>보건소</option>
                </select>
            </div>
            <div class="flex items-center space-x-2">
                <span class="form-label">지역</span>
                <select class="form-input w-28" id="regionSelect">
                    <option>서울특</option>
                </select>
            </div>
            <div class="flex items-center space-x-2">
                <span class="form-label">기관</span>
                <select class="form-input w-28" id="agencySelect">
                    <option>전체</option>
                </select>
            </div>
            <div class="flex items-center space-x-2">
                <span class="form-label">사용자명</span>
                <input type="text" class="form-input w-28" id="userNameInput">
            </div>
            <div class="flex items-center space-x-2">
                <!-- 사용자그룹 필터 콤보박스에 새로운 옵션을 적용합니다. -->
                <span class="form-label">사용자그룹</span>
                <select class="form-input w-28" id="userGroupFilterSelect">
                    <option value="전체">전체</option>
                    <option value="시스템관리">시스템관리</option>
                    <option value="사업운영자">사업운영자</option>
                    <option value="시도 담당자">시도 담당자</option>
                    <option value="업무담당자">업무담당자</option>
                    <option value="금연상담사">금연상담사</option>
                    <option value="금연지도원">금연지도원</option>
                    <option value="금연상담사+금연지도원">금연상담사+금연지도원</option>
                    <option value="금연조사원">금연조사원</option>
                    <option value="학교선생님">학교선생님</option>
                    <option value="유지보수 담당자">유지보수 담당자</option>
                </select>
            </div>
            <div class="flex items-center space-x-2">
                <span class="form-label">사용자유무</span>
                <select class="form-input w-28" id="userStatusSelect">
                    <option>전체</option>
                </select>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div class="grid grid-cols-[1fr_1.15fr] md:grid-cols-[1fr_1.15fr] gap-4">
            <!-- Left Column: User List Grid -->
            <div>
                <div class="flex items-center justify-between mb-2">
                    <span class="font-bold text-lg">사용자 리스트</span>
                    <div class="flex items-center text-sm space-x-2">
                        <input type="checkbox" id="manage_target">
                        <label for="manage_target">관리대상수</label>
                        <button class="btn btn-gray">퇴사자 조회</button>
                    </div>
                </div>
                <!-- 사용자 리스트를 표시할 영역 -->
                <div id="userListGrid" class="bg-white p-2 border border-gray-300 rounded-md overflow-y-auto" style="height: 400px;">
                    <!-- Table header -->
                    <div class="grid grid-cols-4 text-xs font-bold text-gray-700 p-2 border-b border-gray-300">
                        <div>사용자ID</div>
                        <div>이름</div>
                        <div>조직명</div>
                        <div>사용자그룹</div>
                    </div>
                    <!-- 데이터가 동적으로 추가될 영역 -->
                </div>
            </div>

            <!-- Right Column: User Details and Registration Form -->
            <div>
                <!-- User Details Section -->
                <div class="form-section mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-lg">사용자 상세정보</span>
                        <div class="flex items-center text-red-500 text-sm">
                            <span class="mr-1">※</span> 비밀번호 초기화
                        </div>
                    </div>
                    <!-- Updated layout for user details to ensure labels are in one line -->
                    <div class="grid grid-cols-2 gap-2 text-sm items-center">
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">계정유형</span>
                            <select class="form-input w-3/4" id="accountTypeSelect">
                                <option>선택</option>
                                <option>개인</option>
                                <option>조직</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">휴면계정</span>
                            <div class="flex w-3/4 space-x-1">
                                <button class="btn btn-gray" id="dormantBtn">해제</button>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">업무구분</span>
                            <!-- 업무구분 콤보박스에 새로운 옵션을 적용합니다. -->
                            <select class="form-input w-3/4" id="businessDivisionSelect">
                                <option>선택</option>
                                <option>보건소 금연클리닉</option>
                                <option>군의경 금연사업</option>
                                <option>단기금연캠프</option>
                                <option>찾아가는 금연서비스</option>
                                <option>학교흡연예방사업</option>
                                <option>담배마케팅 모니터링</option>
                                <option>금연상담전화</option>
                                <option>금연치료 건강보험 지원사업</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">사용자명</span>
                            <input type="text" class="form-input w-3/4" id="detailUserNameInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">사용자ID</span>
                            <input type="text" class="form-input w-3/4" id="detailUserIdInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">I-PIN ID</span>
                            <input type="text" class="form-input w-3/4" id="ipinIdInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">조직명</span>
                            <input type="text" class="form-input w-3/4" id="orgNameInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">고용형태</span>
                            <select class="form-input w-3/4" id="employmentTypeSelect">
                                <option>선택</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <!-- 사용자그룹 상세정보 콤보박스에 새로운 옵션을 적용합니다. -->
                            <span class="form-label text-right w-1/4 user-group-label">사용자그룹</span>
                            <select id="userGroupSelect" class="form-input w-3/4">
                                <option value="선택">선택</option>
                                <option value="시스템관리">시스템관리</option>
                                <option value="사업운영자">사업운영자</option>
                                <option value="시도 담당자">시도 담당자</option>
                                <option value="업무담당자">업무담당자</option>
                                <option value="금연상담사">금연상담사</option>
                                <option value="금연지도원">금연지도원</option>
                                <option value="금연상담사+금연지도원">금연상담사+금연지도원</option>
                                <option value="금연조사원">금연조사원</option>
                                <option value="학교선생님">학교선생님</option>
                                <option value="유지보수 담당자">유지보수 담당자</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">직급</span>
                            <select class="form-input w-3/4" id="jobTitleSelect">
                                <option>선택</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">성별</span>
                            <select class="form-input w-3/4" id="genderSelect">
                                <option>선택</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">신규/경력</span>
                            <select class="form-input w-3/4" id="careerTypeSelect">
                                <option>선택</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">경력</span>
                            <input type="text" class="form-input w-1/2" id="careerInput">
                            <span class="form-label">개월</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">지속고용</span>
                            <select class="form-input w-3/4" id="continuousEmploymentSelect">
                                <option>선택</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">약관동의</span>
                            <select class="form-input w-3/4" id="termsAgreementSelect">
                                <option>미동의</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">사용유무</span>
                            <select class="form-input w-3/4" id="usageStatusSelect">
                                <option>선택</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">사유</span>
                            <input type="text" class="form-input w-3/4" id="reasonInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">사용시작일</span>
                            <input type="text" class="form-input w-3/4" id="startDateInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">사용종료일</span>
                            <input type="text" class="form-input w-3/4" id="endDateInput">
                        </div>
                        <div class="col-span-2 text-xs text-gray-500 mt-2">
                            <span>- 는 전문인력 필수입력입니다.</span>
                        </div>
                    </div>
                </div>

                <!-- 사용자(금연상담사) 추가정보 Section -->
                <div id="additionalInfoSection" class="form-section mb-4 hidden-section">
                    <span class="font-bold text-lg block mb-2">사용자(금연상담사) 추가정보</span>
                    <div class="grid grid-cols-2 gap-2 text-sm items-center">
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">생년월일</span>
                            <div class="date-input-container w-3/4">
                                <input type="date" class="form-input" id="dobInput">
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">직위/직급</span>
                            <input type="text" class="form-input w-3/4" id="positionInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">최종학위</span>
                            <select class="form-input w-3/4" id="finalDegreeSelect">
                                <option>선택</option>
                                <option>고졸</option>
                                <option>대졸</option>
                                <option>대학원석사졸</option>
                                <option>대학원박사졸</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">전공분야</span>
                            <select class="form-input w-3/4" id="majorFieldSelect">
                                <option>선택</option>
                                <option>의학</option>
                                <option>간호학</option>
                                <option>보건학</option>
                                <option>상담학</option>
                                <option>심리학</option>
                                <option>교육학</option>
                                <option>기타</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">상담 관련 자격증<br>보유 여부</span>
                            <input type="text" class="form-input w-3/4" id="counselingLicenseInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">서비스 상담 경력</span>
                            <select class="form-input w-3/4" id="serviceCareerSelect">
                                <option>선택</option>
                                <option>상담전화</option>
                                <option>보건소</option>
                                <option>금연캠프</option>
                                <option>찾금</option>
                                <option>군의경</option>
                                <option>병의원</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">상담업무 시작일</span>
                            <div class="date-input-container w-3/4">
                                <input type="date" class="form-input" id="counselingStartDateInput">
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">교육 이수 여부</span>
                            <div class="flex w-3/4 space-x-2">
                                <select id="educationSelect" class="form-input w-3/5">
                                    <option>선택</option>
                                    <option>기초</option>
                                    <option>기본</option>
                                    <option>심화</option>
                                    <option>기타(이수증 업로드)</option>
                                </select>
                                <div id="fileUploadContainer" class="hidden-section flex-1">
                                    <input type="file" class="form-input">
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">전화번호</span>
                            <input type="text" class="form-input w-3/4" id="phoneInput">
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="form-label text-right w-1/4">이메일</span>
                            <input type="email" class="form-input w-3/4" id="emailInput">
                        </div>
                    </div>
                </div>

                <!-- Management Target Section -->
                <div class="form-section">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-lg">관리 대상자</span>
                        <button class="btn btn-gray" id="changeCounselorBtn">상담사 변경</button>
                    </div>
                    <!-- Placeholder for management target list -->
                    <div class="bg-white p-2 border border-gray-300 rounded-md" style="height: 200px;">
                        <!-- Table header placeholder -->
                        <div class="grid grid-cols-2 text-xs font-bold text-gray-700 p-2 border-b border-gray-300">
                            <div>등록번호</div>
                            <div>이름</div>
                        </div>
                        <!-- Table row placeholder -->
                        <div class="grid grid-cols-2 text-xs p-2 hover:bg-gray-100">
                            <div>123456789</div>
                            <div>김영희</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            // 초기 메시지 팝업 관련 요소
            const modal = document.getElementById('initialMessageModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const doNotShowAgainCheckbox = document.getElementById('doNotShowAgain');
            const storageKey = 'showInitialMessage';

            // 필터 및 리스트 관련 요소
            const newBtn = document.getElementById('newBtn');
            const searchBtn = document.getElementById('searchBtn');
            const userListGrid = document.getElementById('userListGrid');
            const userNameInput = document.getElementById('userNameInput');
            const userGroupFilterSelect = document.getElementById('userGroupFilterSelect');
            const excelBtn = document.getElementById('excelBtn'); // 추가된 엑셀 버튼 요소

            // 상세 정보 및 추가 정보 관련 요소
            const detailUserIdInput = document.getElementById('detailUserIdInput');
            const detailUserNameInput = document.getElementById('detailUserNameInput');
            const accountTypeSelect = document.getElementById('accountTypeSelect');
            const businessDivisionSelect = document.getElementById('businessDivisionSelect');
            const ipinIdInput = document.getElementById('ipinIdInput');
            const orgNameInput = document.getElementById('orgNameInput');
            const employmentTypeSelect = document.getElementById('employmentTypeSelect');
            const userGroupSelect = document.getElementById('userGroupSelect');
            const jobTitleSelect = document.getElementById('jobTitleSelect');
            const genderSelect = document.getElementById('genderSelect');
            const careerTypeSelect = document.getElementById('careerTypeSelect');
            const careerInput = document.getElementById('careerInput');
            const continuousEmploymentSelect = document.getElementById('continuousEmploymentSelect');
            const termsAgreementSelect = document.getElementById('termsAgreementSelect');
            const usageStatusSelect = document.getElementById('usageStatusSelect');
            const reasonInput = document.getElementById('reasonInput');
            const startDateInput = document.getElementById('startDateInput');
            const endDateInput = document.getElementById('endDateInput');
            const additionalInfoSection = document.getElementById('additionalInfoSection');
            const dobInput = document.getElementById('dobInput');
            const positionInput = document.getElementById('positionInput');
            const finalDegreeSelect = document.getElementById('finalDegreeSelect');
            const majorFieldSelect = document.getElementById('majorFieldSelect');
            const counselingLicenseInput = document.getElementById('counselingLicenseInput');
            const serviceCareerSelect = document.getElementById('serviceCareerSelect');
            const counselingStartDateInput = document.getElementById('counselingStartDateInput');
            const educationSelect = document.getElementById('educationSelect');
            const fileUploadContainer = document.getElementById('fileUploadContainer');
            const phoneInput = document.getElementById('phoneInput');
            const emailInput = document.getElementById('emailInput');

            // 테스트 데이터 (임시 데이터)
            const testUsers = [
                { id: 'user01', name: '홍길동', organization: '보건소', group: '업무담당자', accountType: '개인', businessDivision: '보건소 금연클리닉', ipinId: '1234-5678', employmentType: '정규직', jobTitle: '주무관', gender: '남성', careerType: '신규', career: '6', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2023-01-01', endDate: '2024-12-31' },
                { id: 'user02', name: '김철수', organization: '보건소', group: '금연상담사', accountType: '개인', businessDivision: '보건소 금연클리닉', ipinId: '9101-1213', employmentType: '계약직', jobTitle: '상담사', gender: '남성', careerType: '경력', career: '12', continuousEmployment: '아니오', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2022-05-01', endDate: '2023-04-30', dob: '1990-03-15', position: '선임 상담사', finalDegree: '대졸', majorField: '상담학', counselingLicense: '상담사 2급', serviceCareer: '보건소', counselingStartDate: '2020-01-01', education: '기본', phone: '010-1234-5678', email: 'kimcs@example.com' },
                { id: 'user03', name: '이영희', organization: '보건소', group: '금연지도원', accountType: '조직', businessDivision: '군의경 금연사업', ipinId: '1415-1617', employmentType: '정규직', jobTitle: '지도원', gender: '여성', careerType: '신규', career: '3', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2024-02-01', endDate: '2025-01-31' },
                { id: 'user04', name: '박민준', organization: '병원', group: '금연상담사+금연지도원', accountType: '개인', businessDivision: '단기금연캠프', ipinId: '1819-2021', employmentType: '계약직', jobTitle: '상담/지도원', gender: '남성', careerType: '경력', career: '24', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2021-08-01', endDate: '2024-07-31', dob: '1985-10-20', position: '총괄 책임자', finalDegree: '대학원석사졸', majorField: '의학', counselingLicense: '의사 면허', serviceCareer: '금연캠프', counselingStartDate: '2019-03-01', education: '심화', phone: '010-9876-5432', email: 'parkmj@example.com' },
                { id: 'user05', name: '최지훈', organization: '학교', group: '학교선생님', accountType: '조직', businessDivision: '학교흡연예방사업', ipinId: '2223-2425', employmentType: '정규직', jobTitle: '선생님', gender: '남성', careerType: '신규', career: '1', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2024-03-01', endDate: '2025-02-28' },
                { id: 'user06', name: '정하나', organization: '보건소', group: '업무담당자', accountType: '개인', businessDivision: '보건소 금연클리닉', ipinId: '2627-2829', employmentType: '정규직', jobTitle: '주무관', gender: '여성', careerType: '경력', career: '36', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2020-05-10', endDate: '2025-05-09' },
                { id: 'user07', name: '강서준', organization: '보건소', group: '금연상담사', accountType: '개인', businessDivision: '보건소 금연클리닉', ipinId: '3031-3233', employmentType: '계약직', jobTitle: '상담사', gender: '남성', careerType: '신규', career: '2', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2024-01-01', endDate: '2025-12-31', dob: '1995-07-22', position: '상담사', finalDegree: '대졸', majorField: '간호학', counselingLicense: '간호사 면허', serviceCareer: '상담전화', counselingStartDate: '2024-01-01', education: '기초', phone: '010-2345-6789', email: 'kangsy@example.com' },
                { id: 'user08', name: '윤지민', organization: '병원', group: '업무담당자', accountType: '조직', businessDivision: '금연치료 건강보험 지원사업', ipinId: '3435-3637', employmentType: '정규직', jobTitle: '코디네이터', gender: '여성', careerType: '경력', career: '48', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2019-09-01', endDate: '2024-08-31' },
                { id: 'user09', name: '장동건', organization: '보건소', group: '금연지도원', accountType: '개인', businessDivision: '찾아가는 금연서비스', ipinId: '3839-4041', employmentType: '계약직', jobTitle: '지도원', gender: '남성', careerType: '신규', career: '1', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2024-04-01', endDate: '2025-03-31' },
                { id: 'user10', name: '송혜교', organization: '금연상담전화센터', group: '금연상담사', accountType: '개인', businessDivision: '금연상담전화', ipinId: '4243-4445', employmentType: '정규직', jobTitle: '상담사', gender: '여성', careerType: '경력', career: '60', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2018-06-01', endDate: '2024-05-31', dob: '1980-11-25', position: '책임 상담사', finalDegree: '대학원석사졸', majorField: '심리학', counselingLicense: '임상심리사', serviceCareer: '상담전화', counselingStartDate: '2018-06-01', education: '심화', phone: '010-3456-7890', email: 'shg@example.com' },
                { id: 'user11', name: '이민호', organization: '보건소', group: '금연조사원', accountType: '조직', businessDivision: '담배마케팅 모니터링', ipinId: '4647-4849', employmentType: '계약직', jobTitle: '조사원', gender: '남성', careerType: '신규', career: '0', continuousEmployment: '아니오', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2024-05-01', endDate: '2024-10-31' },
                { id: 'user12', name: '전지현', organization: '학교', group: '학교선생님', accountType: '개인', businessDivision: '학교흡연예방사업', ipinId: '5051-5253', employmentType: '정규직', jobTitle: '선생님', gender: '여성', careerType: '경력', career: '120', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2014-03-01', endDate: '2025-02-28' },
                { id: 'user13', name: '김태희', organization: '보건소', group: '금연상담사', accountType: '개인', businessDivision: '보건소 금연클리닉', ipinId: '5455-5657', employmentType: '정규직', jobTitle: '상담사', gender: '여성', careerType: '경력', career: '18', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2023-08-01', endDate: '2024-07-31', dob: '1988-09-09', position: '상담사', finalDegree: '대졸', majorField: '교육학', counselingLicense: '평생교육사', serviceCareer: '보건소', counselingStartDate: '2023-08-01', education: '기본', phone: '010-4567-8901', email: 'kth@example.com' },
                { id: 'user14', name: '이병헌', organization: '찾아가는 금연서비스', group: '업무담당자', accountType: '조직', businessDivision: '찾아가는 금연서비스', ipinId: '5859-6061', employmentType: '계약직', jobTitle: '담당자', gender: '남성', careerType: '경력', career: '72', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2018-01-01', endDate: '2024-12-31' },
                { id: 'user15', name: '손예진', organization: '보건소', group: '금연상담사+금연지도원', accountType: '개인', businessDivision: '보건소 금연클리닉', ipinId: '6263-6465', employmentType: '정규직', jobTitle: '상담/지도원', gender: '여성', careerType: '경력', career: '48', continuousEmployment: '예', termsAgreement: '동의', usageStatus: '사용', reason: '', startDate: '2020-03-01', endDate: '2025-02-28', dob: '1982-01-22', position: '총괄 상담사', finalDegree: '대학원석사졸', majorField: '보건학', counselingLicense: '보건교육사', serviceCareer: '보건소', counselingStartDate: '2020-03-01', education: '기타(이수증 업로드)', phone: '010-5678-9012', email: 'syj@example.com' }
            ];

            // 렌더링 함수
            const renderUserList = (users) => {
                userListGrid.innerHTML = '';
                const header = document.createElement('div');
                header.className = 'grid grid-cols-4 text-xs font-bold text-gray-700 p-2 border-b border-gray-300';
                header.innerHTML = `<div>사용자ID</div><div>이름</div><div>조직명</div><div>사용자그룹</div>`;
                userListGrid.appendChild(header);

                users.forEach(user => {
                    const row = document.createElement('div');
                    row.className = 'user-row grid grid-cols-4 text-xs p-2 border-b border-gray-200 hover:bg-gray-100';
                    row.dataset.userId = user.id;
                    row.innerHTML = `
                        <div>${user.id}</div>
                        <div>${user.name}</div>
                        <div>${user.organization}</div>
                        <div>${user.group}</div>
                    `;
                    userListGrid.appendChild(row);
                });
            };

            // 사용자 상세 정보 표시 함수
            const displayUserDetails = (user) => {
                detailUserIdInput.value = user.id || '';
                detailUserNameInput.value = user.name || '';
                accountTypeSelect.value = user.accountType || '선택';
                businessDivisionSelect.value = user.businessDivision || '선택';
                ipinIdInput.value = user.ipinId || '';
                orgNameInput.value = user.organization || '';
                employmentTypeSelect.value = user.employmentType || '선택';
                userGroupSelect.value = user.group || '선택';
                jobTitleSelect.value = user.jobTitle || '선택';
                genderSelect.value = user.gender || '선택';
                careerTypeSelect.value = user.careerType || '선택';
                careerInput.value = user.career || '';
                continuousEmploymentSelect.value = user.continuousEmployment || '선택';
                termsAgreementSelect.value = user.termsAgreement || '미동의';
                usageStatusSelect.value = user.usageStatus || '선택';
                reasonInput.value = user.reason || '';
                startDateInput.value = user.startDate || '';
                endDateInput.value = user.endDate || '';

                // 추가 정보 섹션
                dobInput.value = user.dob || '';
                positionInput.value = user.position || '';
                finalDegreeSelect.value = user.finalDegree || '선택';
                majorFieldSelect.value = user.majorField || '선택';
                counselingLicenseInput.value = user.counselingLicense || '';
                serviceCareerSelect.value = user.serviceCareer || '선택';
                counselingStartDateInput.value = user.counselingStartDate || '';
                educationSelect.value = user.education || '선택';
                phoneInput.value = user.phone || '';
                emailInput.value = user.email || '';
                
                // 사용자그룹에 따른 추가 정보 섹션 표시/숨김
                if (user.group === '금연상담사' || user.group === '금연상담사+금연지도원') {
                    additionalInfoSection.classList.remove('hidden-section');
                } else {
                    additionalInfoSection.classList.add('hidden-section');
                }
            };
            
            // 상세 정보 초기화 함수
            const clearUserDetails = () => {
                const allInputs = document.querySelectorAll('.form-input');
                allInputs.forEach(input => {
                    if (input.tagName === 'SELECT') {
                        input.value = input.options[0].value;
                    } else {
                        input.value = '';
                    }
                });
                // 상세 정보 섹션 숨김
                additionalInfoSection.classList.add('hidden-section');
                // 모든 행의 선택 상태 해제
                const allRows = document.querySelectorAll('.user-row');
                allRows.forEach(row => row.classList.remove('selected'));
            };
            
            // 초기 메시지 팝업 처리
            if (localStorage.getItem(storageKey) !== 'false') {
                modal.style.display = 'flex';
            }
            closeModalBtn.addEventListener('click', () => {
                if (doNotShowAgainCheckbox.checked) {
                    localStorage.setItem(storageKey, 'false');
                }
                modal.style.display = 'none';
            });
            
            // 사용자 목록 클릭 이벤트 리스너
            userListGrid.addEventListener('click', (e) => {
                const row = e.target.closest('.user-row');
                if (row) {
                    const userId = row.dataset.userId;
                    const selectedUser = testUsers.find(user => user.id === userId);
                    
                    // 모든 행의 선택 상태 초기화
                    const allRows = document.querySelectorAll('.user-row');
                    allRows.forEach(r => r.classList.remove('selected'));
                    
                    // 현재 클릭된 행에 선택 상태 적용
                    row.classList.add('selected');
                    
                    displayUserDetails(selectedUser);
                }
            });
            
            // '신규' 버튼 클릭 이벤트 리스너
            newBtn.addEventListener('click', () => {
                clearUserDetails();
            });

            // '조회' 버튼 클릭 이벤트 리스너 (필터링 기능)
            searchBtn.addEventListener('click', () => {
                const userName = userNameInput.value.toLowerCase();
                const userGroup = userGroupFilterSelect.value;
                
                const filteredUsers = testUsers.filter(user => {
                    const nameMatch = user.name.toLowerCase().includes(userName);
                    const groupMatch = userGroup === '전체' || user.group === userGroup;
                    return nameMatch && groupMatch;
                });
                
                renderUserList(filteredUsers);
                
                // 필터링 후 첫 번째 사용자 정보 표시
                if (filteredUsers.length > 0) {
                    displayUserDetails(filteredUsers[0]);
                    userListGrid.querySelector('.user-row').classList.add('selected');
                } else {
                    // 리스트가 비어있을 경우 상세 정보 초기화
                    clearUserDetails();
                }
            });
            
            // '엑셀' 버튼 클릭 이벤트 리스너 (추가된 기능)
            excelBtn.addEventListener('click', () => {
                // CSV 헤더를 동적으로 생성합니다.
                const userHeaders = ['사용자ID', '이름', '조직명', '사용자그룹'];
                const detailHeaders = ['계정유형', '업무구분', '사용자ID', 'I-PIN ID', '조직명', '고용형태', '사용자그룹', '직급', '성별', '신규/경력', '경력', '지속고용', '약관동의', '사용유무', '사유', '사용시작일', '사용종료일'];
                const additionalHeaders = ['생년월일', '직위/직급', '최종학위', '전공분야', '상담 관련 자격증 보유 여부', '서비스 상담 경력', '상담업무 시작일', '교육 이수 여부', '전화번호', '이메일'];

                const allHeaders = [...userHeaders, ...detailHeaders, ...additionalHeaders];
                
                const dataToExport = testUsers.map(user => {
                    const row = [
                        user.id || '',
                        user.name || '',
                        user.organization || '',
                        user.group || '',
                        user.accountType || '',
                        user.businessDivision || '',
                        user.id || '', // 사용자ID 중복
                        user.ipinId || '',
                        user.organization || '', // 조직명 중복
                        user.employmentType || '',
                        user.group || '', // 사용자그룹 중복
                        user.jobTitle || '',
                        user.gender || '',
                        user.careerType || '',
                        user.career || '',
                        user.continuousEmployment || '',
                        user.termsAgreement || '',
                        user.usageStatus || '',
                        user.reason || '',
                        user.startDate || '',
                        user.endDate || '',
                        user.dob || '',
                        user.position || '',
                        user.finalDegree || '',
                        user.majorField || '',
                        user.counselingLicense || '',
                        user.serviceCareer || '',
                        user.counselingStartDate || '',
                        user.education || '',
                        user.phone || '',
                        user.email || ''
                    ];
                    // CSV에서 콤마(,)가 포함된 값은 큰따옴표로 감싸야 합니다.
                    return row.map(value => `"${String(value).replace(/"/g, '""')}"`).join(',');
                });

                // CSV 형식으로 데이터를 조합합니다.
                const csvContent = [
                    allHeaders.map(header => `"${header}"`).join(','),
                    ...dataToExport
                ].join('\n');
                
                // UTF-8 BOM을 추가하여 한글 깨짐을 방지합니다.
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                // 가상의 링크를 생성하여 클릭 이벤트를 발생시킵니다.
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', 'users_all_data.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // 사용자그룹 상세 정보 콤보박스 변경 이벤트 (추가 정보 영역 표시/숨기기)
            userGroupSelect.addEventListener('change', (e) => {
                const selectedValue = e.target.value;
                if (selectedValue === '금연상담사' || selectedValue === '금연상담사+금연지도원') {
                    additionalInfoSection.classList.remove('hidden-section');
                } else {
                    additionalInfoSection.classList.add('hidden-section');
                }
            });

            // 교육 이수 여부 콤보박스 변경 이벤트 (파일 업로드 영역 표시/숨기기)
            educationSelect.addEventListener('change', (e) => {
                if (e.target.value === '기타(이수증 업로드)') {
                    fileUploadContainer.classList.remove('hidden-section');
                } else {
                    fileUploadContainer.classList.add('hidden-section');
                }
            });
            
            // 페이지 로드 시 초기 데이터 렌더링
            renderUserList(testUsers);
            if (testUsers.length > 0) {
                displayUserDetails(testUsers[0]);
                userListGrid.querySelector('.user-row').classList.add('selected');
            }
        });
    </script>
</body>
</html>
